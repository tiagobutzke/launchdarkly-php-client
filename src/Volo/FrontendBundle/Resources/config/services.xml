<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <imports>
        <import resource="api.xml"/>
        <import resource="converters.xml"/>
    </imports>

    <parameters>
        <parameter key="framework.service.session_handler.class">Drak\NativeSession\NativeRedisSessionHandler</parameter>
        <parameter key="twig.extension.intl.class">Twig_Extensions_Extension_Intl</parameter>
        <parameter key="volo_frontend.security.authenticator.class">Volo\FrontendBundle\Security\ApiAuthenticator</parameter>
        <parameter key="volo_frontend.twig.cms_extension.class">Volo\FrontendBundle\Twig\CmsExtension</parameter>
        <parameter key="volo_frontend.twig.vendor_extension.class">Volo\FrontendBundle\Twig\VendorExtension</parameter>
        <parameter key="doctrine_cache.php_file.class">Volo\FrontendBundle\Service\Provider\TranslatorCache</parameter>
        <parameter key="volo_frontend.service.configuration.class">Volo\FrontendBundle\Service\ConfigurationService</parameter>
        <parameter key="volo_frontend.service.customer.class">Volo\FrontendBundle\Service\CustomerService</parameter>
        <parameter key="volo_frontend.service.phone_number.class">Volo\FrontendBundle\Service\PhoneNumberService</parameter>
        <parameter key="volo_frontend.service.cart_manager.class">Volo\FrontendBundle\Service\CartManagerService</parameter>
        <parameter key="volo_frontend.service.order_manager.class">Volo\FrontendBundle\Service\OrderManagerService</parameter>
        <parameter key="volo_frontend.service.deliverability.class">Volo\FrontendBundle\Service\DeliverabilityService</parameter>
        <parameter key="volo_frontend.cache_warmer.class">Volo\FrontendBundle\CacheWarmer\VoloCacheWarmer</parameter>
        <parameter key="volo_frontend.translation_cache_warmer.class">Volo\FrontendBundle\CacheWarmer\TranslationCacheWarmer</parameter>
        <parameter key="volo_frontend.cache_migration.class">Volo\FrontendBundle\CacheWarmer\MigrationCacheWarmer</parameter>
        <parameter key="volo_frontend.twig.serializer_extension.class">Volo\FrontendBundle\Twig\SerializerExtension</parameter>
        <parameter key="volo_frontend.service.customer_location.class">Volo\FrontendBundle\Service\CustomerLocationService</parameter>
        <parameter key="volo_frontend.service.vendor.class">Volo\FrontendBundle\Service\VendorService</parameter>
        <parameter key="volo_frontend.twig.vendor_image_extension.class">Volo\FrontendBundle\Twig\ThumborImageExtension</parameter>
        <parameter key="volo_frontend.twig.volo_extension.class">Volo\FrontendBundle\Twig\VoloExtension</parameter>
        <parameter key="volo_frontend.thumbor_builder_factory.class">Thumbor\Url\BuilderFactory</parameter>
        <parameter key="volo_frontend.thumbor_dumper.class">Volo\FrontendBundle\Dumper\ThumborConfigurationDumper</parameter>
        <parameter key="volo_frontend.service.api_error_translator.class">Volo\FrontendBundle\Service\ApiErrorTranslator</parameter>
    </parameters>

    <services>
        <service id="session.handler.redis" class="%framework.service.session_handler.class%">
            <argument type="string">%session_handler_redis_save_path%</argument>
        </service>

        <service id="volo_frontend.twig.volo_extension" class="%volo_frontend.twig.volo_extension.class%">
            <argument>%locale%</argument>
            <argument type="service" id="volo_frontend.service.cart_manager" />
            <argument type="service" id="session" />
            <tag name="twig.extension"/>
        </service>

        <service id="volo_frontend.security.authenticator" class="%volo_frontend.security.authenticator.class%">
            <argument type="service" id="volo_frontend.provider.customer" />
            <argument type="service" id="volo_frontend.api.authenticator" />
        </service>

        <service id="volo_frontend.service.customer_manager" alias="volo_frontend.provider.customer" />
        <service id="volo_frontend.twig.cms_extension" class="%volo_frontend.twig.cms_extension.class%">
            <argument type="service" id="volo_frontend.provider.cms" />
            <tag name="twig.extension" />
        </service>

        <service id="volo_frontend.twig.vendor_extension" class="%volo_frontend.twig.vendor_extension.class%">
            <argument>%locale%</argument>
            <tag name="twig.extension" />
        </service>

        <service id="volo_frontend.service.cart_manager" class="%volo_frontend.service.cart_manager.class%">
            <argument type="service" id="doctrine_cache.providers.configuration_cache" />
            <argument type="service" id="volo_frontend.provider.cart" />
        </service>

        <service id="volo_frontend.service.order_manager" class="%volo_frontend.service.order_manager.class%">
            <argument type="service" id="volo_frontend.provider.order" />
            <argument type="service" id="volo_frontend.provider.customer" />
            <argument type="service" id="volo_frontend.provider.cart" />
            <argument>%foodpanda.api.client_id%</argument>
        </service>

        <service id="volo_frontend.service.configuration" class="%volo_frontend.service.configuration.class%">
            <argument type="service" id="doctrine_cache.providers.configuration_cache" />
            <argument type="service" id="volo_frontend.provider.configuration" />
            <argument>%volo_frontend.api.configuration.life_time%</argument>
        </service>

        <service id="volo_frontend.cache_warmer" class="%volo_frontend.cache_warmer.class%">
            <argument type="service" id="volo_frontend.service.configuration" />
            <tag name="kernel.cache_warmer" priority="90" />
        </service>

        <service id="volo_frontend.translation_cache_warmer" class="%volo_frontend.translation_cache_warmer.class%">
            <argument type="service" id="foodpanda.core.web_translate_it.translation_sync_service" />
            <argument>%foodpanda_web_translate_it.main_translation_label%</argument>
            <tag name="kernel.cache_warmer" priority="90" />
        </service>

        <service id="volo_frontend.cache_migration" class="%volo_frontend.cache_migration.class%">
            <argument type="service" id="volo_frontend.service.vendor" />
            <tag name="kernel.cache_warmer" priority="90" />
        </service>

        <service id="volo_frontend.service.customer" class="%volo_frontend.service.customer.class%">
            <argument type="service" id="security.token_storage" />
            <argument type="service" id="volo_frontend.provider.customer" />
            <argument type="service" id="volo_frontend.api.serializer"/>
            <argument type="service" id="volo_frontend.service.phone_number" />
        </service>

        <service id="volo_frontend.service.vendor" class="%volo_frontend.service.vendor.class%">
            <argument type="service" id="volo_frontend.provider.city" />
            <argument type="service" id="volo_frontend.provider.vendor" />
            <argument type="service" id="doctrine_cache.providers.vendor_cache" />
        </service>

        <service id="volo_frontend.twig.serializer_extension" class="%volo_frontend.twig.serializer_extension.class%">
            <argument type="service" id="volo_frontend.api.serializer" />
            <tag name="twig.extension" />
        </service>

        <service id="volo_frontend.thumbor_builder_factory" class="%volo_frontend.thumbor_builder_factory.class%">
            <argument type="string">%volo_frontend.thumbor_base_url%</argument>
            <argument type="string">%volo_frontend.thumbor_secret%</argument>
        </service>

        <!-- the class property is needed even if the service is constructed by a factory
             since symfony might need to add method calls based on compile-time checks. -->
        <service id="volo_frontend.thumbor_transformers" class="ArrayObject" public="false">
            <factory service="service_container" method="getParameter"/>
            <argument>phumbor.transformations</argument>
        </service>

        <service id="volo_frontend.twig.vendor_image_extension" class="%volo_frontend.twig.vendor_image_extension.class%">
            <argument type="service" id="volo_frontend.thumbor_transformers" />
            <tag name="twig.extension" />
        </service>

        <service id="volo_frontend.thumbor_dumper" class="%volo_frontend.thumbor_dumper.class%">
            <argument type="service" id="volo_frontend.thumbor_transformers" />
        </service>

        <service id="volo_frontend.service.deliverability" class="%volo_frontend.service.deliverability.class%">
            <argument type="service" id="volo_frontend.provider.vendor" />
        </service>

        <service id="volo_frontend.service.customer_location" class="%volo_frontend.service.customer_location.class%" />

        <service id="volo_frontend.service.phone_number" class="%volo_frontend.service.phone_number.class%">
            <argument type="service" id="libphonenumber.phone_number_util" />
            <argument>%locale%</argument>
        </service>

        <service id="volo_frontend.service.api_error_translator" class="%volo_frontend.service.api_error_translator.class%">
            <argument type="service" id="translator" />
        </service>
    </services>
</container>
